if(importScripts("https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-sw.js"),self.workbox){workbox.core.setCacheNameDetails({prefix:"cinemagic"}),workbox.core.skipWaiting(),workbox.core.clientsClaim(),workbox.routing.registerRoute((({request:e})=>"navigate"===e.mode),new workbox.strategies.NetworkFirst({cacheName:"cinemagic-pages",networkTimeoutSeconds:5,plugins:[new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:86400})]})),workbox.routing.registerRoute((({request:e})=>["style","script","worker"].includes(e.destination)),new workbox.strategies.StaleWhileRevalidate({cacheName:"cinemagic-static"})),workbox.routing.registerRoute((({url:e})=>e.pathname.includes("hot-update")),new workbox.strategies.NetworkOnly({})),workbox.routing.registerRoute((({request:e})=>"image"===e.destination),new workbox.strategies.CacheFirst({cacheName:"cinemagic-images",plugins:[new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]}),new workbox.expiration.ExpirationPlugin({maxEntries:100,maxAgeSeconds:604800})]})),workbox.routing.registerRoute((({url:e,request:t})=>"GET"===t.method&&e.pathname.includes("/stories")),new workbox.strategies.StaleWhileRevalidate({cacheName:"cinemagic-api-stories",plugins:[new workbox.cacheableResponse.CacheableResponsePlugin({statuses:[0,200]}),new workbox.expiration.ExpirationPlugin({maxEntries:50,maxAgeSeconds:3600})]}));const e=new workbox.backgroundSync.BackgroundSyncPlugin("story-upload-queue",{maxRetentionTime:1440});workbox.routing.registerRoute((({url:e,request:t})=>"POST"===t.method&&e.pathname.endsWith("/stories")),new workbox.strategies.NetworkOnly({plugins:[e]}),"POST")}else self.addEventListener("install",(e=>{self.skipWaiting()})),self.addEventListener("activate",(e=>{self.clients.claim()}));self.addEventListener("push",(e=>{let t={};try{t=e.data?e.data.json():{}}catch(o){t={body:e.data?e.data.text():""}}const o=t.title||"CINEMAGIC",i={body:t.body||"Ada update terbaru dari CINEMAGIC",icon:t.icon||"images/logo.png",badge:t.badge||"images/logo.png",data:{url:t.url||"./#/stories",storyId:t.storyId||null},actions:[{action:"open-detail",title:"Lihat Detail"},{action:"open-stories",title:"Buka Daftar"}]};e.waitUntil(self.registration.showNotification(o,i))})),self.addEventListener("notificationclick",(e=>{e.notification.close();const t=e.notification&&e.notification.data?e.notification.data:{};let o=t.url||"./";"open-detail"===e.action&&t.storyId?o=`./#/story/${t.storyId}`:"open-stories"===e.action&&(o="./#/stories"),e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const t of e)if("focus"in t)return t.navigate?t.navigate(o).then((()=>t.focus())):t.focus();return clients.openWindow(o)})))}));